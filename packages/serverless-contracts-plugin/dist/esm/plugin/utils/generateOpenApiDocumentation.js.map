{"version":3,"file":"generateOpenApiDocumentation.js","names":["getOpenApiDocumentation","isDefined","generateOpenApiDocumentation","serverless","service","initialServerlessConfig","contracts","provides","contractDocumentations","Object","values","map","contract","filter","paths","reduce","pathsObject","pathDocumentation","path","method","documentation","openApiDocumentation","openapi","info","title","getServiceName","description","resources","Description","version","Date","toISOString","console","log","JSON","stringify"],"sources":["../../../../src/plugin/utils/generateOpenApiDocumentation.ts"],"sourcesContent":["import { OpenAPIV3 } from 'openapi-types';\nimport Serverless from 'serverless';\n\nimport { getOpenApiDocumentation } from '@swarmion/serverless-contracts';\n\nimport { ServerlessContracts } from 'types/serviceOptions';\n\nimport { isDefined } from './isDefined';\n\nexport const generateOpenApiDocumentation = (serverless: Serverless): void => {\n  // @ts-ignore mistype in the orignals (the animals)\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n  const { provides } = serverless.service.initialServerlessConfig\n    .contracts as ServerlessContracts;\n\n  const contractDocumentations = Object.values(provides)\n    .map(contract => getOpenApiDocumentation(contract))\n    .filter(isDefined);\n\n  const paths: OpenAPIV3.PathsObject =\n    contractDocumentations.reduce<OpenAPIV3.PathsObject>(\n      (pathsObject, pathDocumentation) => {\n        pathsObject[pathDocumentation.path] = {\n          [pathDocumentation.method]: pathDocumentation.documentation,\n        };\n\n        return pathsObject;\n      },\n      {},\n    );\n\n  const openApiDocumentation: OpenAPIV3.Document = {\n    openapi: '3.0.1',\n    info: {\n      title: serverless.service.getServiceName(),\n      description: (serverless.service.initialServerlessConfig as Serverless)\n        .resources.Description,\n      version: new Date().toISOString(),\n    },\n    paths,\n  };\n  console.log(JSON.stringify(openApiDocumentation, null, 2));\n};\n"],"mappings":";AAGA,SAASA,uBAAuB,QAAQ,gCAAgC;AAIxE,SAASC,SAAS;AAElB,OAAO,IAAMC,4BAA4B,GAAG,SAA/BA,4BAA4B,CAAIC,UAAsB,EAAW;EAC5E;EACA;EACA,WAAqBA,UAAU,CAACC,OAAO,CAACC,uBAAuB,CAC5DC,SAAS;IADJC,QAAQ,QAARA,QAAQ;EAGhB,IAAMC,sBAAsB,GAAGC,MAAM,CAACC,MAAM,CAACH,QAAQ,CAAC,CACnDI,GAAG,CAAC,UAAAC,QAAQ;IAAA,OAAIZ,uBAAuB,CAACY,QAAQ,CAAC;EAAA,EAAC,CAClDC,MAAM,CAACZ,SAAS,CAAC;EAEpB,IAAMa,KAA4B,GAChCN,sBAAsB,CAACO,MAAM,CAC3B,UAACC,WAAW,EAAEC,iBAAiB,EAAK;IAClCD,WAAW,CAACC,iBAAiB,CAACC,IAAI,CAAC,uBAChCD,iBAAiB,CAACE,MAAM,EAAGF,iBAAiB,CAACG,aAAa,CAC5D;IAED,OAAOJ,WAAW;EACpB,CAAC,EACD,CAAC,CAAC,CACH;EAEH,IAAMK,oBAAwC,GAAG;IAC/CC,OAAO,EAAE,OAAO;IAChBC,IAAI,EAAE;MACJC,KAAK,EAAErB,UAAU,CAACC,OAAO,CAACqB,cAAc,EAAE;MAC1CC,WAAW,EAAGvB,UAAU,CAACC,OAAO,CAACC,uBAAuB,CACrDsB,SAAS,CAACC,WAAW;MACxBC,OAAO,EAAE,IAAIC,IAAI,EAAE,CAACC,WAAW;IACjC,CAAC;IACDjB,KAAK,EAALA;EACF,CAAC;EACDkB,OAAO,CAACC,GAAG,CAACC,IAAI,CAACC,SAAS,CAACd,oBAAoB,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;AAC5D,CAAC"}